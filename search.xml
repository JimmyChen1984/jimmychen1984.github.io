<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[Android Module Build 安卓单模块快速编译]]></title>
      <url>http://jimmychen.me/2016/09/22/AndroidModuleBuild/</url>
      <content type="html"><![CDATA[<blockquote>
<p>&#x80CC;&#x666F;: &#x901A;&#x5E38;&#x5927;&#x5BB6;&#x5728;&#x4FEE;&#x6539;Android Codebase&#x4E4B;&#x540E;&#x90FD;&#x662F;&#x5E0C;&#x671B;&#x80FD;&#x5FEB;&#x901F;&#x7684;&#x9A8C;&#x8BC1;&#xFF0C;&#x5728;make clean&#x524D;&#x63D0;&#x518D;make, &#x518D;&#x5F3A;&#x52B2;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E5F;&#x662F;&#x4F1A;&#x88AB;&#x7F16;&#x8BD1;&#x6574;&#x4E2A;Android System&#x4E5F;&#x514D;&#x4E0D;&#x4E86;&#x6F2B;&#x957F;&#x7684;&#x7B49;&#x5F85;, &#x7B49;&#x5F85;&#x4E00;&#x4E2A;&#x597D;&#x7ED3;&#x679C;&#x4E5F;&#x5C31;&#x5FCD;&#x4E86;&#xFF0C;&#x53EF;&#x60DC;&#x5927;&#x90E8;&#x5206;&#x65F6;&#x5019;&#x5C31;&#x662F;&#x7B49;&#x4E86;&#x5FEB;&#x534A;&#x4E2A;&#x5C0F;&#x65F6;&#x4E4B;&#x540E;&#x53D1;&#x73B0;&#x4F60;&#x7684;&#x8BED;&#x6CD5;&#x5199;&#x9519;&#x4E86;&#xFF08;&#x4E5F;&#x8BB8;&#x771F;&#x7684;&#x53EA;&#x662F;&#x5C11;&#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x62EC;&#x53F7;&#xFF09;&#xFF0C;&#x4F60;&#x5F20;&#x5F00;&#x5634;&#x5927;&#x558A;F<em>*</em>, &#x4E0D;&#x8FC7;&#x4EE3;&#x7801;&#x662F;&#x4F60;&#x81EA;&#x5DF1;&#x5199;&#x7684;,&#x4E5F;&#x53EA;&#x80FD;&#x81EA;&#x5DF1;&#x541E;&#x56DE;&#x53BB;,&#x53EA;&#x6709;&#x518D;&#x6765;&#x4E00;&#x904D;&#x7684;&#x52C7;&#x6C14;, &#x53C8;&#x662F;&#x534A;&#x5C0F;&#x65F6;&#x4E4B;&#x540E;&#x2026;(&#x8FD9;&#x6B21;&#x53EF;&#x80FD;&#x591A;&#x4E86;&#x4E00;&#x4E2A;&#x62EC;&#x53F7;)<br>&#x5176;&#x5B9E;&#x5927;&#x90E8;&#x5206;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x4FEE;&#x6539;&#x7684;&#x4E1C;&#x897F;&#x90FD;&#x662F;&#x57FA;&#x4E8E;&#x67D0;&#x4E00;&#x4E2A;&#x6216;&#x8005;&#x51E0;&#x4E2A;&#x6A21;&#x5757;&#x7684;&#xFF0C;&#x7406;&#x8BBA;&#x4E0A;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x7F16;&#x8BD1;&#x4F60;&#x6709;&#x4FEE;&#x6539;&#x7684;&#x6A21;&#x5757;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;, &#x4E0D;&#x9700;&#x8981;&#x5927;&#x7B14;&#x4E00;&#x6325;&#xFF0C;Build&#x6574;&#x4E2A;Codebase&#x2026;<br>&#x6240;&#x4EE5;, &#x6211;&#x4EEC;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#x57FA;&#x4E8E;Android Codebase&#x5FEB;&#x901F;&#x7F16;&#x8BD1;&#x6A21;&#x5757;, &#x7136;&#x540E;&#x76F4;&#x63A5;&#x5C06;&#x7F16;&#x8BD1;&#x7684;&#x6A21;&#x5757;push&#x5230;&#x624B;&#x673A;&#x91CC;&#x9762;&#x8FDB;&#x884C;&#x9A8C;&#x8BC1;&#x6D4B;&#x8BD5;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;.</p>
</blockquote>
<p>&#x5206;&#x4EAB;&#x4E00;&#x500B;Linux&#x4E0B;&#x5FEB;&#x901F;&#x7F16;&#x8BD1;Android&#x5355;&#x4E2A;&#x6A21;&#x5757;&#x548C;&#x66FF;&#x6362;&#x7684;&#x811A;&#x672C;, &#x5982;&#x679C;&#x4F60;&#x662F;&#x7F16;&#x8BD1;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x8C03;&#x8BD5;Android&#x771F;&#x673A;&#x7684;&#x8BDD;, &#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5408;&#x5E76;&#x4E24;&#x4E2A;&#x811A;&#x672C;, &#x5C06;&#x7F16;&#x8BD1;&#x548C;&#x66FF;&#x6362;&#x4E00;&#x6B65;&#x5B8C;&#x6210;, &#x6572;&#x4E0B;Enter&#x952E;&#x4E4B;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x53BB;&#x559D;&#x676F;&#x5496;&#x5561;&#x8F6C;&#x60A0;&#x4E00;&#x4E0B;&#xFF08;&#x653E;&#x5FC3;&#x5427;, 80%&#x7684;&#x60C5;&#x51B5;&#x662F;&#x8BED;&#x6CD5;&#x51FA;&#x9519;&#x4E86;, &#x4E0D;&#x8FC7;&#x8FD9;&#x6B21;&#x53EA;&#x9700;&#x8981;5&#x5206;&#x949F;&#x5DE6;&#x53F3;&#x5C31;&#x80FD;&#x5F88;&#x5FEB;&#x53D1;&#x73B0;&#x95EE;&#x9898;.&#xFF09;</p>
<p>&#x4EE5;&#x4F60;&#x4FEE;&#x6539;&#x4E86;frameworks/base/services&#x4E3A;&#x5217;,&#x60F3;&#x5FEB;&#x901F;&#x7684;&#x7F16;&#x8BD1;&#x51FA;&#x4F60;&#x4FEE;&#x6539;&#x8FC7;&#x7684;services.jar&#x6765;&#x9A8C;&#x8BC1;&#x76F8;&#x5173;&#x7684;&#x529F;&#x80FD;.  </p>
<ol>
<li><p>&#x5728;android&#x76EE;&#x5F55;&#x4E0B;touch bdservices.sh&#xFF0C;chmod +x bdservices.sh &#x5185;&#x5BB9;&#x53C2;&#x8003;&#x5982;&#x4E0B;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash  </div><div class="line">echo &quot;1.Configure android build environment&quot;  </div><div class="line">source ./build/envsetup.sh  </div><div class="line">echo &quot;Warning:You should build this product_name before!!!&quot;  </div><div class="line">lunch aosp_arm-eng  </div><div class="line">echo &quot;2.Remove the temp file&quot;  </div><div class="line">rm $ANDROID_BUILD_TOP/out/target/common/obj/JAVA_LIBRARIES/services* -rf  </div><div class="line">rm $ANDROID_PRODUCT_OUT/obj/JAVA_LIBRARIES/services_intermediates/ -rf  </div><div class="line">rm $ANDROID_PRODUCT_OUT/system/framework/services.jar  </div><div class="line">echo &quot;3.Build single service module&quot;  </div><div class="line">cd $ANDROID_BUILD_TOP/frameworks/base/services  </div><div class="line">mm  </div><div class="line">if [ -f $ANDROID_PRODUCT_OUT/system/framework/services.jar ]  </div><div class="line">then  </div><div class="line">    echo &quot;Build services.jar successfully!&quot;  </div><div class="line">else  </div><div class="line">    echo &quot;Build services.jar failed!&quot;  </div><div class="line">fi</div></pre></td></tr></table></figure>
</li>
<li><p>pushservices.sh<br>&#x76F4;&#x63A5;&#x66FF;&#x6362;&#x624B;&#x673A;&#x91CC;&#x6216;&#x8005;&#x6A21;&#x62DF;&#x5668;&#x4E2D;&#x4F60;&#x521A;&#x521A;&#x7F16;&#x8BD1;&#x51FA;&#x4F86;&#x7684;services.jar&#x6765;&#x9A8C;&#x8BC1;.<br>&#x8BB0;&#x5F97;&#x9A8C;&#x8BC1;&#x4E4B;&#x524D;&#x8981;&#x91CD;&#x542F;,&#x4E0D;&#x7136;&#x4F60;&#x5C31;&#x5728;&#x539F;&#x5730;&#x8E0F;&#x6B65;,&#x4F60;&#x4FEE;&#x6539;&#x7684;&#x4E1C;&#x897F;&#x4E0D;&#x8D77;&#x4EFB;&#x4F55;&#x4F5C;&#x7528;&#x66F4;&#x52A0;&#x4F1A;&#x8BEF;&#x5BFC;&#x4F60;&#x7684;&#x5224;&#x65AD;.<br>&#x5982;&#x679C;&#x5728;Windows&#x7CFB;&#x7EDF;&#x4E0A;&#x8BF7;&#x4FEE;&#x6539;&#x6210;bat&#x6765;&#x8FD0;&#x884C;&#x5373;&#x53EF;,&#x5B89;&#x88C5;Cygwin&#x4E5F;&#x53EF;&#x4EE5;.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash  </div><div class="line">adb root  </div><div class="line">echo &quot;1.Wait for 3 sec after reconnect adb again&quot;  </div><div class="line">ping -n 3 127.0.0.1&gt;null  </div><div class="line">echo &quot;2.Remount the system&quot;  </div><div class="line">adb remount  </div><div class="line">adb shell rm /system/framework/services.jar  </div><div class="line">adb shell rm -rf /system/framework/oat  </div><div class="line">adb push services.jar /system/framework/services.jar  </div><div class="line">echo &quot;3.Must reboot android system after replace system file&quot;  </div><div class="line">adb reboot android</div></pre></td></tr></table></figure>
</li>
<li><p>&#x5982;&#x679C;&#x4F60;&#x9700;&#x8981;&#x51FA;&#x4E00;&#x4E2A; system image,<br>&#x53EA;&#x9700;&#x8981;&#x5728;android&#x76EE;&#x5F55;&#x4E0B;make snod&#x4F1A;&#x81EA;&#x52A8;&#x5C06;&#x4F60;&#x7F16;&#x8BD1;&#x7684;out&#x4E2D;&#x6240;&#x6709;&#x4E1C;&#x897F;&#x6253;&#x5305;&#x6210;system.img,&#x4F60;&#x518D;&#x628A;&#x4ED6;&#x901A;&#x8FC7;fastboot flash&#x5230;&#x624B;&#x673A;.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd $ANDROID_BUILD_TOP  </div><div class="line">make snod</div></pre></td></tr></table></figure>
</li>
</ol>
<p>&#x8FD9;&#x8FB9;&#x53EA;&#x662F;&#x63D0;&#x4F9B;build&#x548C;push&#x7684;&#x5355;&#x4E2A;&#x6A21;&#x5757;&#x601D;&#x8DEF;&#xFF0C;&#x811A;&#x672C;&#x6211;&#x89C9;&#x5F97;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x518D;&#x4F18;&#x5316;,&#x6838;&#x5FC3;&#x7684;&#x601D;&#x60F3;&#x7406;&#x89E3;&#x5C31;&#x884C;&#x4E86;&#xFF0C;&#x5E0C;&#x671B;&#x5927;&#x5BB6;&#x80FD;&#x591F;&#x638C;&#x63E1;Android&#x5355;&#x6A21;&#x5757;&#x7684;&#x7F16;&#x8BD1;&#x548C;&#x66FF;&#x6362;&#x77E5;&#x8BC6;&#xFF0C;&#x56E0;&#x4E3A;&#x4F60;build&#x7684;&#x8D8A;&#x5FEB;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x7684;&#x6548;&#x7387;&#x4E5F;&#x5C31;&#x8D8A;&#x9AD8;.&#x200B;</p>
<p>&#x53C2;&#x8003;&#x8D44;&#x6599;:<br>cat /build/envsetup.sh<br><img src="/2016/09/22/AndroidModuleBuild/mmbuildhelp.png" alt="logo"></p>
<p>&#x6709;&#x95EE;&#x9898;&#x6B22;&#x8FCE;&#x5927;&#x5BB6;&#x63D0;&#x51FA;&#x6765;&#x8BA8;&#x8BBA;,&#x4E00;&#x8D77;&#x8FDB;&#x6B65;&#x5427;.&#x8BF7;&#x539F;&#x8C05;&#x6211;&#x6E23;&#x4E00;&#x822C;&#x7684;&#x6587;&#x7B14;~~</p>
<p>JimmyChen@20160901</p>
]]></content>
    </entry>
    
  
  
</search>
